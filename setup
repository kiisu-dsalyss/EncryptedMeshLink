#!/bin/bash

# EncryptedMeshLink Setup Script
# Simple wrapper for one-command installation

set -e

echo "ü•ß EncryptedMeshLink Setup"
echo "=========================="
echo ""

# Check if we're on a supported system
if [[ "$OSTYPE" == "linux-gnu"* ]]; then
    echo "‚úÖ Linux system detected"
else
    echo "‚ùå This setup script is designed for Linux systems (like Raspberry Pi OS)"
    echo "   For other systems, please check the documentation."
    exit 1
fi

# Check architecture
ARCH=$(uname -m)
case $ARCH in
    aarch64|arm64|armv7l)
        echo "‚úÖ ARM architecture detected ($ARCH) - perfect for Raspberry Pi!"
        ;;
    x86_64)
        echo "üñ•Ô∏è  x86_64 detected - this will work but is optimized for Raspberry Pi"
        ;;
    *)
        echo "‚ö†Ô∏è  Unknown architecture: $ARCH - continuing anyway..."
        ;;
esac

echo ""
echo "üì• Downloading and running the installation script..."
echo ""

# Download and run the quick deploy script
curl -fsSL https://raw.githubusercontent.com/kiisu-dsalyss/EncryptedMeshLink/master/scripts/quick-deploy-pi.sh | bash

# Check if the installation was successful
if [ $? -eq 0 ]; then
    echo ""
    echo "üéâ Setup completed successfully!"
    echo ""
    echo "üìã Quick reference:"
    echo "   Project location: ~/encryptedmeshlink"
    echo "   View logs:        cd ~/encryptedmeshlink && docker-compose logs -f"
    echo "   Service status:   cd ~/encryptedmeshlink && docker-compose ps"
    echo ""
else
    echo ""
    echo "‚ùå Setup failed. Please check the error messages above."
    echo "   For help, visit: https://github.com/kiisu-dsalyss/EncryptedMeshLink"
    exit 1
fi
